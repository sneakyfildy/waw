/**

  Font.js v2012.01.25
  (c) Mike "Pomax" Kamermans, 2012
  Licensed under MIT ("expat" flavour) license.
  Hosted on http://github.com/Pomax/Font.js

  This library adds Font objects to the general pool
  of available JavaScript objects, so that you can load
  fonts through a JavaScript object similar to loading
  images through a new Image() object.

  Font.js is compatible with all browsers that support
  <canvas> and Object.defineProperty - This includes
  all versions of Firefox, Chrome, Opera, IE and Safari
  that were 'current' (Firefox 9, Chrome 16, Opera 11.6,
  IE9, Safari 5.1) at the time Font.js was released.

  Font.js will not work on IE8 or below due to the lack
  of Object.defineProperty - I recommend using the
  solution outlined in http://ie6update.com/ for websites
  that are not corporate intranet sites, because as a home
  user you have no excuse not to have upgraded to Internet
  Explorer 9 yet, or simply not using Internet Explorer if
  you're still using Windows XP. If you have friends or
  family that still use IE8 or below: intervene.

  You may remove every line in this header except for
  the first block of four lines, for the purposes of
  saving space and minification. If minification strips
  the header, you'll have to paste that paragraph back in.

  Issue tracker: https://github.com/Pomax/Font.js/issues

**/
!function(a){function b(){this.fontFamily="fjs"+(0|999999*Math.random())}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";!function(a){function d(a,b){return this.slice(a,b)}function e(a,b){var c,d=a.length;for(arguments.length<2&&(b=0),c=0;d>c;++c,++b)this[b]=255&a[c]}function f(a){var b,c;if("number"==typeof a)for(b=new Array(a),c=0;a>c;++c)b[c]=0;else b=a.slice(0);return b.subarray=d,b.buffer=b,b.byteLength=b.length,b.set=e,"object"==typeof a&&a.buffer&&(b.buffer=a.buffer),b}try{return new Uint8Array(1),void 0}catch(c){}a.Uint8Array=f,a.Uint32Array=f,a.Int32Array=f}(a),function(a){if(!(a.opera||"response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype)){var b;b=a.VBArray?function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}:function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:b})}}(a),a.btoa||(a.btoa=function(a){var c,d,e,f,g,h,i,j,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),j=c<<16|d<<8|e,f=63&j>>18,g=63&j>>12,h=63&j>>6,i=63&j,n[l++]=b.charAt(f)+b.charAt(g)+b.charAt(h)+b.charAt(i);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)}),b.prototype.url="",b.prototype.format="",b.prototype.data="",b.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",b.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},b.prototype.systemfont=!1,b.prototype.loaded=!1,b.prototype.onload=function(){},b.prototype.onerror=function(){},b.prototype.canvas=!1,b.prototype.context=!1,b.prototype.validate=function(a,b,c,d,e){if(e!==!1&&0>e)return this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed)."),void 0;var f=getComputedStyle(a,null).getPropertyValue("width").replace("px","");f>0?(document.head.removeChild(b),document.body.removeChild(a),this.loaded=!0,this.onload()):(console.log("timing out"),setTimeout(function(){d.validate(a,b,c,d,e===!1?!1:e-50)},1e3))},b.prototype.ondownloaded=function(){var a=this,b=function(a){return String.fromCharCode(a)},c=function(a){if(256>a)return b(0)+b(a);var c=a>>8,d=255&a;return b(c)+b(d)},e=function(a,b){return 256*a+b},f=function(a,b){var d,c=1===a>>7;return a=127&a,d=256*a+b,c?d-32768:d},g=function(a,b,c,d){return 16777216*a+65536*b+256*c+d},h=function(b){a.onerror(b)},i=b(0)+b(1)+b(0)+b(0),j="OTTO",k=this.data,l=b(k[0])+b(k[1])+b(k[2])+b(k[3]),m=l===i,n=m?!1:l===j;if(m)this.format="truetype";else{if(!n)return h("Error: file at "+this.url+" cannot be interpreted as OpenType font."),void 0;this.format="opentype"}var q,t,o=e(k[4],k[5]),p=12,r=p+16*o,s={};for(q=p;r>q;q+=16)t=b(k[q])+b(k[q+1])+b(k[q+2])+b(k[q+3]),s[t]={name:t,checksum:g(k[q+4],k[q+5],k[q+6],k[q+7]),offset:g(k[q+8],k[q+9],k[q+10],k[q+11]),length:g(k[q+12],k[q+13],k[q+14],k[q+15])};var u=function(a){return s[a]?a:(h("Error: font is missing the required OpenType '"+a+"' table."),!1)};if(t=u("head"),t!==!1){q=s[t].offset,s[t].version=""+k[q]+k[q+1]+k[q+2]+k[q+3];var v=e(k[q+18],k[q+19]);if(this.metrics.quadsize=v,t=u("hhea"),t!==!1&&(q=s[t].offset,s[t].version=""+k[q]+k[q+1]+k[q+2]+k[q+3],this.metrics.ascent=f(k[q+4],k[q+5])/v,this.metrics.descent=f(k[q+6],k[q+7])/v,this.metrics.leading=f(k[q+8],k[q+9])/v,t=u("OS/2"),t!==!1&&(q=s[t].offset,s[t].version=""+k[q]+k[q+1],this.metrics.weightclass=e(k[q+4],k[q+5]),t=u("cmap"),t!==!1))){q=s[t].offset,s[t].version=""+k[q]+k[q+1],o=e(k[q+2],k[q+3]);for(var w,x,y,z,A,B=!1,w=0;o>w;w++)x=q+4+8*w,y=e(k[x],k[x+1]),z=e(k[x+2],k[x+3]),A=g(k[x+4],k[x+5],k[x+6],k[x+7]),3===y&&1===z&&(B=A);var C="A";if(B!==!1&&(q+=B,l=e(k[q],k[q+1]),4===l)){for(var D=e(k[q+6],k[q+7])/2,E=function(a){return-1===[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(a)},F=q+14,G=q+14+2*D,H=!1;G>F&&(H=e(k[F],k[F+1]),!E(H));F+=2)H=!1;if(0!=H){C=String.fromCharCode(H);var I=(-(H-1)+65536)%65536,J=b(0)+c(H)+c(65535)+c(0)+c(H)+c(65535)+c(I)+c(1),K=btoa(J);this.base64=this.base64.substring(0,380)+K+this.base64.substring(380+K.length)}}this.bootstrapValidation(C,!1)}}},b.prototype.bootstrapValidation=function(a,b){var c=this.fontFamily+" testfont",d=document.createElement("style");d.setAttribute("type","text/css"),d.innerHTML="@font-face {\n  font-family: '"+c+"';\n"+"  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n"+"       format('truetype');}",document.head.appendChild(d);var e=!1;this.systemfont||(e=this.toStyleNode(),document.head.appendChild(e));var f=document.createElement("p");if(f.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",f.style.fontFamily="'"+this.fontFamily+"', '"+c+"'",f.innerHTML=a+a+a+a+a+a+a+a+a+a,document.body.appendChild(f),"undefined"==typeof getComputedStyle)this.onload(),error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var g=this.systemfont?1e3:this.metrics.quadsize,h=document.createElement("canvas");h.width=g,h.height=g,this.canvas=h;var i=h.getContext("2d");i.font="1em '"+this.fontFamily+"'",i.fillStyle="white",i.fillRect(-1,-1,g+2,g+2),i.fillStyle="black",i.fillText("test text",50,g/2),this.context=i;var j=this,k=function(){j.validate(f,d,e,j,b)};setTimeout(k,50)}},b.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},b.prototype.loadFont=function(){var a=this;if(-1===this.url.indexOf("."))return setTimeout(function(){a.processSystemFont()},10),void 0;var b=new XMLHttpRequest;b.open("GET",a.url,!0),b.responseType="arraybuffer",b.onload=function(){var d=b.response;d?(a.data=new Uint8Array(d),a.ondownloaded()):a.onerror("Error downloading font resource from "+a.url)},b.onerror=function(){a.onerror("Error downloading font resource from "+a.url)},b.send(null)},b.prototype.styleNode=!1,b.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css";var a="@font-face {\n";return a+="  font-family: '"+this.fontFamily+"';\n",a+="  src: url('"+this.url+"') format('"+this.format+"');\n",a+="}",this.styleNode.innerHTML=a,this.styleNode},b.prototype.measureText=function(a,b){if(!this.loaded)return this.onerror("measureText() was called while the font was not yet loaded"),!1;this.context.font=b+"px '"+this.fontFamily+"'";var c=this.context.measureText(a);c.fontsize=b,c.ascent=0,c.descent=0,c.bounds={minx:0,maxx:c.width,miny:0,maxy:0},c.height=0;var d=[],e=c.width/this.metrics.quadsize;1>=e?d.push(a):d.push(a);var g,f=d.length;for(g=0;f>g;g++)this.measureSegment(d[g],b,c);return c},b.prototype.measureSegment=function(a,b,c){var e,d=function(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)},f=document.createElement("div");f.style.position="absolute",f.style.opacity=0,f.style.font=b+"px '"+this.fontFamily+"'";var g=10;for(f.innerHTML=a,e=1;g>e;e++)f.innerHTML+="<br/>"+a;document.body.appendChild(f),c.leading=1.2*b;var h=d(f,"height");if(h=h.replace("px",""),h>=b*g&&(c.leading=0|h/g),document.body.removeChild(f),/^\s*$/.test(a))return c;var j=(this.canvas,this.context),k=this.systemfont?1e3:this.metrics.quadsize,l=k,m=k,n=k/2,o=50,p=(k-c.width)/2;p!==(0|p)&&(p=0|p),j.fillStyle="white",j.fillRect(-o,-o,l+2*o,m+2*o),j.fillStyle="black",j.fillText(a,p,n);for(var q=0|c.width+o,r=4*b,s=p-o/2,t=n-r/2,u=j.getImageData(s,t,q,r).data,e=0,v=0,w=4*q,x=u.length,y=r/2;++e<x&&255===u[e];);var z=0|e/w;for(e=x-1;--e>0&&255===u[e];);var A=0|e/w;for(e=0,v=0;q>v&&255===u[e];)e+=w,e>=x&&(v++,e=e-x+4);var B=v,C=1;for(e=x-3,v=0;q>v&&255===u[e];)e-=w,0>e&&(v++,e=x-3-4*C++);var D=q-v;return c.ascent=y-z,c.descent=A-y,c.bounds={minx:B-o/2,maxx:D-o/2,miny:-c.descent,maxy:c.ascent},c.height=1+(A-z),c},Object.defineProperty(b.prototype,"src",{set:function(a){this.url=a,this.loadFont()}}),"undefined"!=typeof define?define(function(){return b}):a.Font=b}(window);